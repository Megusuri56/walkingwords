<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title>散步背单词</title>
    <meta name="author" content="目薬">
    <meta name="copyright" content="目薬">
    <link rel="shortcut icon" href="img/favicon.png">
    <style type="text/css">
        .topright{
        position:absolute;
        top:8px;
        right:8px;
        line-height:0%;
        font-size:0.85em;
        color:#cc8800;
        vertical-align:top;
        }
        .hintText{
        line-height:50%;
        font-size:0.6em;
        color:#cc8800;
        }
        #switchMobile{ 
            margin-top:30px; 
            height:22px;
            position:absolute;
            bottom:10%;
            left:5%
         }
        #switchMobile span {
	background:#fde5ba;
	
	padding: 5px 30px 5px 30px;
	font-size:16px;
	font-weight:bold;
	border-radius:10px;
	
	-webkit-transition:all linear 0.30s;
	-moz-transition:all linear 0.30s;
	transition:all linear 0.30s;	
        }
        .help{position:absolute;top:0;left:0;width:100%;height:100%;}
        .helpText{
                  overflow:auto;
	font-weight:bold;
                  position:absolute;
                  top:10%;
                  left:6%;
                  width:70%;
                  height:70%;
	padding: 5px 30px 5px 30px;
	border-radius:10px;
	background:#ffffff;	
	opacity:0.9;
                  filter:alpha(opacity=90);
        }
    </style>
</head>
<body style="background-color:#ffd480">
<div class="topright">
   <img src="img/info.png" onclick='document.getElementsByClassName("help")[0].removeAttribute("hidden")'></img>
</div>
<div id="text">
    <h2>背单词</h2>
    <h4 id="word">加载中，请稍候...</h4>
    <h4 id="meaning" hidden></h4>
</div>

<div id="buttons">
    <img id="voice" src="img/voice.png" onclick="Voice()" onmousemove='document.getElementById("copyHint").removeAttribute("hidden")' onmouseout='document.getElementById("copyHint").setAttribute("hidden",true)' title="音频" hidden></img><span class="hintText" id="copyHint" hidden>点击复制音频链接</span>
    <div id="copy"></div>
<form name="input">
        <input type="text" name="inputbox" oninput="check()" onmousemove="showHint()" onmouseout="hideHint()" hidden />
        <span class="hintText" id="notknowW" style="text-decoration-line:underline" onclick="notknowAct()" hidden>查看答案</span>
</form>
    <p class="hintText" id="hint"><br /></p>
</div>
<div id="buttonsR">
    <button id="know" onclick="knowAct()" hidden>我认识</button>
    <button id="notknow" onclick="notknowAct()" hidden>我不认识</button>
</div>
    <br /><br />
    <p style="line-height:0%"></p>
<div id="switchBox">
    <div id="switch" onclick="modeswitch()" hidden><button>切换模式</button></div>
</div>
    <p class="hintText" id="amount" style="line-height:110%" hidden><br />你今天已经认识了<span>_</span>个单词，总共打卡<span>_</span>天，认识了<span>_</span>个单词</p>

<div class="help" onclick='document.getElementsByClassName("help")[0].setAttribute("hidden",true)' hidden>
    <div class="helpText">
    <p>你好！这是我制作的背单词网页，祝你使用愉快！</p>
    <p>本网站使用Cookie存储你的背单词数据，所以一定不要清空Cookie！</p>
    <p>三个月没有打开这个网站的话数据会自动删除哦，所以请按时打卡吧！</p>
    <p>我的Github账号：<a href="https://github.com/Megusuri56" target="_blank">https://github.com/Megusuri56</a>，欢迎关注我！</p>
    <p style="text-align: right">目薬</p>
    </div>
</div>
</body>

<script type="text/javascript">
    var word;
    var mode = "write";
    var knowAmount = 0;
    var wordsAmount = 50;
    var oldwordsAmount = 0;
    var days = 0;
    var allwords = 0;
    var d = new Date();
    d.setTime(d.getTime()+90*24*60*60*1000);
    var expires = "expires="+d.toGMTString();
    var today = new Date();
    today.setTime(today.getTime());
    var punchedIn = 0;
    var notknowArr = new Array();
    var wordList;    

    checkBrowser();
    checkCookie();
    showWord();
    document.getElementById("amount").removeAttribute("hidden");
    document.getElementById("voice").removeAttribute("hidden");
    document.getElementById("switch").removeAttribute("hidden");
    document.forms["input"]["inputbox"].removeAttribute("hidden");
    document.getElementById("notknowW").removeAttribute("hidden");

    function checkCookie()
    {
        var cookie = document.cookie;
        if (cookie == "")
        {
            setCookie();
        }
        else
        {
            if (getCookie("today")==today.toLocaleDateString())
            {
                knowAmount = Number(getCookie("knowAmount"));
                punchedIn = Number(getCookie("punchedIn"));
            }
            days = Number(getCookie("days"));
            allwords = Number(getCookie("allwords"));
            wordsAmount = Number(getCookie("wordsAmount"));
            oldwordsAmount = Number(getCookie("oldwordsAmount"));
            getNKArr();
        }
    }

    function setCookie()
    {
        document.cookie = "knowAmount="+knowAmount.toString()+";"+expires;
        document.cookie = "wordsAmount="+wordsAmount.toString()+";"+expires;
        document.cookie = "oldwordsAmount="+oldwordsAmount.toString()+";"+expires;
        document.cookie = "days="+days.toString()+";"+expires;
        document.cookie = "allwords="+allwords.toString()+";"+expires;
        document.cookie = "today="+today.toLocaleDateString()+";"+expires;
        document.cookie = "punchedIn="+punchedIn.toString()+";"+expires;
        setNKCookie();
    }

function getCookie(cname)
{
  var name = cname + "=";
  var ca = document.cookie.split(';');
  for(var i=0; i<ca.length; i++) 
  {
    var c = ca[i].trim();
    if (c.indexOf(name)==0) return c.substring(name.length,c.length);
  }
  return "";
}

    function showHint()
    {
         document.getElementById("hint").innerHTML = "输入假名，按空格提交单词";
    }
    function hideHint()
    {
         document.getElementById("hint").innerHTML = "<br />";
    }

    function modeswitch()
    {
        if(mode =="write")
        {
            mode = "read";
        }
        else
        {
            mode = "write";
        }
        modeAct();
    }

function modeAct()
{
if(mode =="write")
        {
            document.getElementById("word").innerHTML=word.word;
            document.getElementById("know").setAttribute("hidden",true);
            document.getElementById("notknow").setAttribute("hidden",true);
            document.forms["input"]["inputbox"].removeAttribute("hidden");
            document.getElementById("meaning").removeAttribute("hidden");
            document.getElementById("notknowW").removeAttribute("hidden");
        }
        else
        {
            document.getElementById("word").innerHTML=word.word+"("+word.furigana+")";
            document.getElementById("know").removeAttribute("hidden");
            document.getElementById("notknow").removeAttribute("hidden");
            document.forms["input"]["inputbox"].setAttribute("hidden",true);
            document.getElementById("meaning").setAttribute("hidden",true);
            document.getElementById("notknowW").setAttribute("hidden",true);
            document.getElementById("know").innerHTML="我认识";
            document.getElementById("know").onclick=knowAct;
        }
}

function check()
{
var input = document.forms["input"]["inputbox"].value;
if(input==word.furigana+" ")
{
knowAct();
document.forms["input"]["inputbox"].value = "";
}
} 

function showWord()
{
var xmlhttp;
if (window.XMLHttpRequest)
  {
  xmlhttp=new XMLHttpRequest();
  }
else
  {
  xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
  }
xmlhttp.onreadystatechange=function()
  {
  if (xmlhttp.readyState==4 && xmlhttp.status==200)
    {
    wordList = JSON.parse(xmlhttp.responseText);
    wordList = wordList.RECORDS;
    let i=Math.round(Math.random()*50);
    if (i<=(wordsAmount-oldwordsAmount))
    {
        word=wordList[Math.round(Math.random()*1699)];
    }
    else
    {
        word=notknowArr[Math.round(Math.random()*notknowArr.length)];
    }
    document.getElementById("meaning").innerHTML=word.meaning;
    modeAct();
    document.getElementById("amount").getElementsByTagName("span")[0].innerHTML=knowAmount.toString();
    document.getElementById("amount").getElementsByTagName("span")[1].innerHTML=days.toString();
    document.getElementById("amount").getElementsByTagName("span")[2].innerHTML=allwords.toString();
    }
}
xmlhttp.open("GET","https://megusuri56.github.io/walkingwords/words.json",true);
xmlhttp.send();
}
    function showMeaning()
    {
    document.getElementById("meaning").removeAttribute("hidden");
    }
    function showFurigana()
    {
    document.getElementById("word").innerHTML=word.word+"("+word.furigana+")";
    }
function Voice()
{
var tkk = eval('((function(){var a\x3d222433949;var b\x3d4070417730;return 422881+\x27.\x27+(a+b)})())');
function tk(a,TKK) {
        for (var e = TKK.split("."), h = Number(e[0]) || 0, g = [], d = 0, f = 0; f < a.length; f++) {
            var c = a.charCodeAt(f);
            128 > c ? g[d++] = c : (2048 > c ? g[d++] = c >> 6 | 192 : (55296 == (c & 64512) && f + 1 < a.length && 56320 == (a.charCodeAt(f + 1) & 64512) ? (c = 65536 + ((c & 1023) << 10) + (a.charCodeAt(++f) & 1023), g[d++] = c >> 18 | 240, g[d++] = c >> 12 & 63 | 128) : g[d++] = c >> 12 | 224, g[d++] = c >> 6 & 63 | 128), g[d++] = c & 63 | 128)
        }
        a = h;
        for (d = 0; d < g.length; d++) a += g[d], a = b(a, "+-a^+6");
        a = b(a, "+-3^+b+-f");
        a ^= Number(e[1]) || 0;
        0 > a && (a = (a & 2147483647) + 2147483648);
        a %= 1E6;
        return a.toString() + "." + (a ^ h)
    }
function b(a, b) {
        for (var d = 0; d < b.length - 2; d += 3) {
            var c = b.charAt(d + 2),
                c = "a" <= c ? c.charCodeAt(0) - 87 : Number(c),
                c = "+" == b.charAt(d + 1) ? a >>> c : a << c;
            a = "+" == b.charAt(d) ? a + c & 4294967295 : a ^ c
        }
        return a
    }
var URL = "https://translate.google.cn/translate_tts?ie=UTF-8&q="+word.word+"&tl=ja&ie=UTF-8&total=1&idx=0&textlen=39&tk="+tk(word.word,tkk)+"&client=t&prev=input";
document.getElementById("copy").innerHTML='<input type="text" id="copyarea" value="'+URL+'"/>';
document.getElementById("copyarea").select();
document.execCommand("Copy")
document.getElementById("copy").innerHTML="";
}
function checkBrowser()
{
if (!!navigator.userAgent.match(/AppleWebKit.*Mobile.*/))
{
    document.getElementsByTagName("h2")[0].innerHTML="背单词<br /><br />";
    document.getElementById("text").style="font-size:1.1em"
    document.getElementById("word").style="text-align: center;font-size:2em";
    document.getElementById("meaning").style="text-align: center";
    document.getElementById("buttons").style="margin-left:20%";
    document.getElementById("notknowW").style="text-decoration-line:underline;font-size:1.1em";
    document.getElementById("buttonsR").style="margin: auto;width:133px";
    document.getElementById("switchBox").id="switchMobile";
    document.getElementById("switch").innerHTML="<span>切换模式</span>";
    document.getElementById("amount").style="line-height:130%;position:absolute;bottom:10px";
    document.getElementById("amount").getElementsByTagName("span")[0].style="font-size:2em";
    document.getElementById("amount").getElementsByTagName("span")[1].style="font-size:2em";
    document.getElementById("amount").getElementsByTagName("span")[2].style="font-size:2em";
}
}
function punchIn()
{
    days++;
    punchedIn=1;
    alert("✨恭喜你，成功打卡！✨");
}

function notknowAct()
{
if (mode=="write")
{
    showFurigana();
}
else
{
    showMeaning();
    document.getElementById("know").innerHTML="下一个";
    document.getElementById("know").onclick=showWord;
}
addNK(word);
}
function knowAct()
{
    showWord();
    knowAmount++;
    allwords++;
    if (knowAmount>=wordsAmount&&punchedIn==0)
    {
        punchIn();
    }
    setCookie();
}
function getNKArr()
{
  for(let i=0; i<oldwordsAmount; i++) 
  {
    notknowArr.push(getCookie("w"+i.toString()));
  }
}
function setNKCookie()
{
  for(let i=0; i<oldwordsAmount; i++) 
  {
        document.cookie = "w"+i.toString()+"="+notknowArr[i]+";"+expires;
  }    
}
function findNK(target)
{
    if (indexOf(target)!=-1)
    {
        for(let w of wordList)
        {
            if(w.furigana==target)
            {
                return w;
            }
        }
        return null;
    }
    else
    {
        return null;
    }
}
function addNK(target)
{
    if (notknowArr.length<oldwordsAmount&&indexOf(target)==-1&&target!="")
    {
        notknowArr.push(target);
    }
}
</script>
</html>
