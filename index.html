<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title>散步背单词</title>
    <meta name="author" content="目薬">
    <meta name="copyright" content="目薬">
    <link rel="shortcut icon" href="img/favicon.png">
    <style type="text/css">
        .topright{
        float:right;
        margin-top:0px;
        margin-right:0px;
        line-height:0%;
        font-size:0.85em;
        color:#cc8800;
        vertical-align:top;
        }
        .hintText{
        line-height:50%;
        font-size:0.6em;
        color:#cc8800;
        }
    </style>
</head>
<body style="background-color:#ffd480">
    <div class="topright">
    </div>
    <h2>背单词</h2>
    <h4 id="word">加载中，请稍候...</h4>
    <h4 id="meaning" hidden></h4>

<div id="buttons">
    <img id="voice" src="img/voice.png" onclick="Voice()" onmousemove='document.getElementById("copyHint").removeAttribute("hidden")' onmouseout='document.getElementById("copyHint").setAttribute("hidden",true)' title="音频" hidden></img><span class="hintText" id="copyHint" hidden>点击复制音频链接</span>
    <div id="copy"></div>
<form name="input">
        <input type="text" name="inputbox" oninput="check()" onmousemove="showHint()" onmouseout="hideHint()" hidden />
        <span class="hintText" id="notknowW" style="text-decoration-line:underline" onclick="showFurigana()" hidden>我不认识</span>
</form>
    <p class="hintText" id="hint"><br /></p>
</div>
<div id="buttonsR">
    <button id="know" onclick="showWord()" hidden>我认识</button>
    <button id="notknow" onclick="showMeaning()" hidden>我不认识</button>
</div>
    <br /><br />
    <p style="line-height:0%"></p>
    <button id="switch" onclick="modeswitch()" hidden>切换模式</button>
    <p class="hintText" id="amount" style="font-size:0.8em;line-height:110%" hidden><br />你今天已经认识了<span>未知</span>个单词，总共打卡<span>未知</span>天，认识了<span>未知</span>个单词</p>
</body>
<script type="text/javascript">
    var word;
    var mode = "write";
    var knowAmount = -1;
    var days = 0;
    var allwords = -1;
    var d = new Date();
    d.setTime(d.getTime()+90*24*60*60*1000);
    var expires = "expires="+d.toGMTString();
    var today = new Date();
    today.setTime(today.getTime());
    checkBrowser();
    checkCookie();
    showWord();
    document.getElementById("amount").removeAttribute("hidden");
    document.getElementById("voice").removeAttribute("hidden");
    document.getElementById("switch").removeAttribute("hidden");
    document.forms["input"]["inputbox"].removeAttribute("hidden");
    document.getElementById("notknowW").removeAttribute("hidden");

    function checkCookie()
    {
        var cookie = document.cookie;
        if (cookie == "")
        {
            setCookie();
        }
        else
        {
            if (getCookie("today")==today.toLocaleDateString())
            {
                knowAmount = Number(getCookie("knowAmount"))-1;
            }
            days = Number(getCookie("days"));
            allwords = Number(getCookie("allwords"))-1;
        }
    }

    function setCookie()
    {
        document.cookie = "knowAmount="+knowAmount.toString()+";"+expires;
        document.cookie = "wordsAmount=50;"+expires;
        document.cookie = "days="+days.toString()+";"+expires;
        document.cookie = "allwords="+allwords.toString()+";"+expires;
        document.cookie = "today="+today.toLocaleDateString()+";"+expires;
    }

function getCookie(cname)
{
  var name = cname + "=";
  var ca = document.cookie.split(';');
  for(var i=0; i<ca.length; i++) 
  {
    var c = ca[i].trim();
    if (c.indexOf(name)==0) return c.substring(name.length,c.length);
  }
  return "";
}

    function showHint()
    {
         document.getElementById("hint").innerHTML = "输入假名，按空格提交单词";
    }
    function hideHint()
    {
         document.getElementById("hint").innerHTML = "<br />";
    }

    function modeswitch()
    {
        if(mode =="write")
        {
            mode = "read";
        }
        else
        {
            mode = "write";
        }
        modeAct();
    }

function modeAct()
{
if(mode =="write")
        {
            document.getElementById("word").innerHTML=word.word;
            document.getElementById("know").setAttribute("hidden",true);
            document.getElementById("notknow").setAttribute("hidden",true);
            document.forms["input"]["inputbox"].removeAttribute("hidden");
            document.getElementById("meaning").removeAttribute("hidden");
            document.getElementById("notknowW").removeAttribute("hidden");
        }
        else
        {
            document.getElementById("word").innerHTML=word.word+"("+word.furigana+")";
            document.getElementById("know").removeAttribute("hidden");
            document.getElementById("notknow").removeAttribute("hidden");
            document.forms["input"]["inputbox"].setAttribute("hidden",true);
            document.getElementById("meaning").setAttribute("hidden",true);
            document.getElementById("notknowW").setAttribute("hidden",true);
        }
}

function check()
{
var input = document.forms["input"]["inputbox"].value;
if(input==word.furigana+" ")
{
showWord();
document.forms["input"]["inputbox"].value = "";
}
} 

function showWord()
{
var xmlhttp;
if (window.XMLHttpRequest)
  {
  xmlhttp=new XMLHttpRequest();
  }
else
  {
  xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
  }
xmlhttp.onreadystatechange=function()
  {
  if (xmlhttp.readyState==4 && xmlhttp.status==200)
    {
    var result = JSON.parse(xmlhttp.responseText);
    result = result.RECORDS;
    word=result[Math.round(Math.random()*1699)]
    document.getElementById("meaning").innerHTML=word.meaning;
    modeAct();
    knowAmount++;
    allwords++;
    document.getElementById("amount").getElementsByTagName("span")[0].innerHTML=knowAmount.toString();
    document.getElementById("amount").getElementsByTagName("span")[1].innerHTML=days.toString();
    document.getElementById("amount").getElementsByTagName("span")[2].innerHTML=allwords.toString();
    setCookie();
    }
}
xmlhttp.open("GET","https://megusuri56.github.io/walkingwords/words.json",true);
xmlhttp.send();
}
    function showMeaning()
    {
    document.getElementById("meaning").removeAttribute("hidden");
    }
    function showFurigana()
    {
    document.getElementById("word").innerHTML=word.word+"("+word.furigana+")";
    }
function Voice()
{
var tkk = eval('((function(){var a\x3d222433949;var b\x3d4070417730;return 422881+\x27.\x27+(a+b)})())');
function tk(a,TKK) {
        for (var e = TKK.split("."), h = Number(e[0]) || 0, g = [], d = 0, f = 0; f < a.length; f++) {
            var c = a.charCodeAt(f);
            128 > c ? g[d++] = c : (2048 > c ? g[d++] = c >> 6 | 192 : (55296 == (c & 64512) && f + 1 < a.length && 56320 == (a.charCodeAt(f + 1) & 64512) ? (c = 65536 + ((c & 1023) << 10) + (a.charCodeAt(++f) & 1023), g[d++] = c >> 18 | 240, g[d++] = c >> 12 & 63 | 128) : g[d++] = c >> 12 | 224, g[d++] = c >> 6 & 63 | 128), g[d++] = c & 63 | 128)
        }
        a = h;
        for (d = 0; d < g.length; d++) a += g[d], a = b(a, "+-a^+6");
        a = b(a, "+-3^+b+-f");
        a ^= Number(e[1]) || 0;
        0 > a && (a = (a & 2147483647) + 2147483648);
        a %= 1E6;
        return a.toString() + "." + (a ^ h)
    }
function b(a, b) {
        for (var d = 0; d < b.length - 2; d += 3) {
            var c = b.charAt(d + 2),
                c = "a" <= c ? c.charCodeAt(0) - 87 : Number(c),
                c = "+" == b.charAt(d + 1) ? a >>> c : a << c;
            a = "+" == b.charAt(d) ? a + c & 4294967295 : a ^ c
        }
        return a
    }
var URL = "https://translate.google.cn/translate_tts?ie=UTF-8&q="+word.word+"&tl=ja&ie=UTF-8&total=1&idx=0&textlen=39&tk="+tk(word.word,tkk)+"&client=t&prev=input";
document.getElementById("copy").innerHTML='<input type="text" id="copyarea" value="'+URL+'"/>';
document.getElementById("copyarea").select();
document.execCommand("Copy")
document.getElementById("copy").innerHTML="";
}
function checkBrowser()
{
if (!!navigator.userAgent.match(/AppleWebKit.*Mobile.*/))
{
    document.getElementById("word").style="text-align: center";
    document.getElementById("meaning").style="text-align: center";
    document.getElementById("buttons").style="margin: auto;width: 220px";
    document.getElementById("buttonsR").style="margin: auto;width:133px";
    document.getElementById("switch").style="position:absolute;bottom:10%";
    document.getElementById("amount").style="line-height:130%;position:absolute;bottom:10px";
    document.getElementById("amount").getElementsByTagName("span")[0].style="font-size:2em";
    document.getElementById("amount").getElementsByTagName("span")[1].style="font-size:2em";
    document.getElementById("amount").getElementsByTagName("span")[2].style="font-size:2em";
}
}
</script>
</html>
